<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Assistant Widget</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Minimal header with just drag area and essential controls -->
    <div class="widget-header">
        <div class="drag-area">
            <span class="widget-title">Home Assistant</span>
            <div class="connection-indicator" id="connection-status"></div>
        </div>
                <div class="header-controls">
                    <button id="settings-btn" class="control-btn" title="Settings">‚öôÔ∏è</button>
                    <button id="minimize-btn" class="control-btn" title="Minimize">‚ûñ</button>
                    <button id="close-btn" class="control-btn" title="Close">‚ùå</button>
                </div>
    </div>

    <!-- Main widget content - single view, no tabs -->
    <div class="widget-content">
        <!-- Quick Status Cards -->
        <div class="status-grid">
            <div class="status-card weather-card" id="weather-card" title="Long-press to configure weather">
                <div class="weather-icon" id="weather-icon">üå§Ô∏è</div>
                <div class="weather-content">
                    <div class="weather-main">
                        <div class="weather-temp" id="weather-temp">--¬∞</div>
                        <div class="weather-condition" id="weather-condition">--</div>
                    </div>
                    <div class="weather-details">
                        <div class="weather-detail">
                            <span class="detail-icon">üíß</span>
                            <span class="detail-value" id="weather-humidity">--%</span>
                        </div>
                        <div class="weather-detail">
                            <span class="detail-icon">üí®</span>
                            <span class="detail-value" id="weather-wind">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="status-card time-card" id="time-card">
                <div class="time-content">
                    <div class="time-main">
                        <div class="time-display" id="current-time">--:--</div>
                    </div>
                    <div class="date-display" id="current-date">--</div>
                </div>
            </div>
        </div>

        <!-- Quick Access -->
        <div class="controls-section">
                    <div class="section-header">
                        <span class="section-title">Quick Access</span>
                        <div class="section-buttons">
                            <button id="reorganize-quick-controls-btn" class="section-btn" title="Reorganize Quick Access">‚ãÆ‚ãÆ</button>
                            <button id="manage-quick-controls-btn" class="section-btn" title="Manage Quick Access">‚ûï</button>
                        </div>
                    </div>
            <div id="quick-controls" class="controls-grid">
                <!-- Dynamic controls will be added here -->
            </div>
        </div>

        <!-- Entity Cards - Hidden by default, shown only when needed -->
        <div class="entities-section hidden">
            <div class="section-header">
                <span class="section-title">Entities</span>
                <div class="section-controls">
                    <button id="filter-btn" class="mini-btn" title="Filter">üîç</button>
                    <button id="layout-btn" class="mini-btn" title="Layout">üìê</button>
                </div>
            </div>
            <div id="entities-container" class="entities-grid">
                <!-- Dynamic entity cards will be added here -->
            </div>
        </div>

    </div>

    <!-- Floating context menu (appears on right-click) -->
    <div id="context-menu" class="context-menu hidden">
        <div class="menu-item" data-action="refresh">üîÑ Refresh</div>
        <div class="menu-item" data-action="settings">‚öôÔ∏è Settings</div>
        <div class="menu-item" data-action="filter">üîç Filter</div>
        <div class="menu-item" data-action="layout">üìê Layout</div>
        <div class="menu-divider"></div>
        <div class="menu-item" data-action="minimize">‚ûñ Minimize</div>
        <div class="menu-item" data-action="close">‚ùå Close</div>
    </div>

    <!-- Settings Modal (same as before but cleaner) -->
    <div id="settings-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settings-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="settings-title">Settings</h2>
                <button id="close-settings" class="close-btn">√ó</button>
            </div>
            <div class="modal-tabs">
                <button class="tab-link active" data-tab="general">General</button>
                <button class="tab-link" data-tab="hotkeys">Hotkeys</button>
                <button class="tab-link" data-tab="alerts">Alerts</button>
                <button class="tab-link" data-tab="updates">Updates</button>
            </div>
            <div class="modal-body">
                <div id="general-tab" class="tab-content active">
                    <div class="form-group">
                        <label for="ha-url">Home Assistant URL:</label>
                        <input type="text" id="ha-url" placeholder="http://homeassistant.local:8123">
                    </div>
                    <div class="form-group">
                        <label for="ha-token">Access Token:</label>
                        <input type="password" id="ha-token" placeholder="Your long-lived access token">
                    </div>
                    <div class="form-group">
                        <label for="update-interval">Update Interval (seconds):</label>
                        <input type="number" id="update-interval" min="1" max="60" value="5">
                    </div>
                    <div class="form-group">
                        <label for="opacity-slider">Window Opacity:</label>
                        <input type="range" id="opacity-slider" min="0.2" max="1" step="0.05" value="0.95">
                        <span id="opacity-value">95%</span>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="always-on-top">
                            Always on top
                        </label>
                    </div>
                </div>
                <div id="hotkeys-tab" class="tab-content">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="global-hotkeys-enabled">
                            Enable Global Hotkeys
                        </label>
                    </div>
                    <div id="hotkeys-list-container">
                        <div class="form-group">
                            <input type="text" id="hotkey-entity-search" placeholder="Search entities to assign hotkeys...">
                        </div>
                        <div id="hotkeys-list"></div>
                    </div>
                    <div class="hotkey-help">
                        <p>Supported modifiers: Ctrl, Alt, Shift, Command, Super.</p>
                        <p>Example: <code>Ctrl+Shift+A</code></p>
                    </div>
                </div>
                <div id="alerts-tab" class="tab-content">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="entity-alerts-enabled">
                            Enable Entity Alerts
                        </label>
                    </div>
                    <div id="alerts-section" style="display: none;">
                        <p>Configure which entities should trigger desktop notifications.</p>
                        <button id="manage-alerts-btn" class="btn btn-secondary">Manage Alerts</button>
                    </div>
                </div>
                <div id="updates-tab" class="tab-content">
                    <div class="form-group update-section">
                        <label>Application Updates</label>
                        <div class="update-info">
                            <div class="version-info">
                                <span>Current Version: <strong id="current-version">Loading...</strong></span>
                            </div>
                            <div class="update-status" id="update-status">
                                <span id="update-status-text">Checking for updates...</span>
                            </div>
                            <div class="update-actions">
                                <button id="check-updates-btn" class="btn btn-secondary" disabled>
                                    <span id="check-updates-text">Check for Updates</span>
                                </button>
                                <button id="install-update-btn" class="btn btn-primary hidden">
                                    <span id="install-update-text">Install Update</span>
                                </button>
                            </div>
                            <div class="update-progress hidden" id="update-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progress-fill"></div>
                                </div>
                                <span class="progress-text" id="progress-text">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-settings" class="btn btn-primary">Save</button>
                <button id="cancel-settings" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Filter Modal (simplified) -->
    <div id="filter-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="filter-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="filter-title">Filter Entities</h2>
                <button id="close-filter" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Domains:</label>
                    <div id="filter-domains" class="checkbox-grid">
                        <!-- Dynamic checkboxes will be added here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="apply-filters" class="btn btn-primary">Apply</button>
                <button id="cancel-filters" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Entity Selector Modal -->
    <div id="entity-selector" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="entity-selector-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="entity-selector-title">Add Entities to Dashboard</h2>
                <button id="close-entity-selector" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" id="entity-search" placeholder="Search entities..." class="form-control">
                </div>
                <div class="form-group">
                    <label>Available Entities:</label>
                    <div id="available-entities-list" class="entity-selector-list">
                        <!-- Available entities will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Access Management Modal -->
    <div id="quick-controls-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="quick-controls-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="quick-controls-title">Manage Quick Access</h2>
                <button id="close-quick-controls" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" id="quick-controls-search" placeholder="Search entities..." class="form-control">
                </div>
                <div class="form-group">
                    <label>Available Entities for Quick Access:</label>
                    <div id="quick-controls-list" class="entity-selector-list">
                        <!-- Available entities will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Weather Configuration Modal -->
    <div id="weather-config-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="weather-config-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="weather-config-title">Configure Weather</h2>
                <button id="close-weather-config" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Select Weather Entity:</label>
                    <div id="weather-entities-list" class="entity-selector-list">
                        <!-- Available weather entities will be loaded here -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Current Weather Entity:</label>
                    <div id="current-weather-info" class="weather-info">
                        <span id="current-weather-name">None selected</span>
                        <button id="clear-weather" class="btn btn-secondary btn-sm">Clear</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Hotkeys Management Modal -->
    <div id="hotkeys-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="hotkeys-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="hotkeys-title">Manage Global Hotkeys</h2>
                <button id="close-hotkeys" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" id="hotkey-search" placeholder="Search entities..." class="form-control">
                </div>
                <div class="form-group">
                    <label>Configure Hotkeys:</label>
                    <div id="hotkeys-list" class="hotkeys-list">
                        <!-- Hotkey configurations will be loaded here -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Existing Hotkeys:</label>
                    <div id="existing-hotkeys-list" class="existing-hotkeys-list">
                        <!-- Existing hotkey configurations will be loaded here -->
                    </div>
                </div>
                <div class="hotkey-help">
                    <h4>Hotkey Format:</h4>
                    <p>Use combinations like: <code>Ctrl+Alt+L</code>, <code>Ctrl+Shift+1</code>, <code>Alt+F1</code></p>
                    <p>Available modifiers: <code>Ctrl</code>, <code>Alt</code>, <code>Shift</code>, <code>Win</code></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Entity Alerts Management Modal -->
    <div id="alerts-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="alerts-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="alerts-title">Manage Entity Alerts</h2>
                <button id="close-alerts" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" id="alert-search" placeholder="Search entities..." class="form-control">
                </div>
                <div class="form-group">
                    <label>Configure Alerts:</label>
                    <div id="alerts-list" class="alerts-list">
                        <!-- Alert configurations will be loaded here -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Existing Alerts:</label>
                    <div id="existing-alerts-list" class="existing-alerts-list">
                        <!-- Existing alert configurations will be loaded here -->
                    </div>
                </div>
                <div class="alert-help">
                    <h4>Alert Types:</h4>
                    <p><strong>State Change:</strong> Notify when entity state changes</p>
                    <p><strong>Specific State:</strong> Notify when entity reaches a specific state</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Hotkey Configuration Modal -->
    <div id="hotkey-config-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="hotkey-config-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="hotkey-config-title">Configure Hotkey</h2>
                <button id="close-hotkey-config" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="hotkey-input">Hotkey Combination:</label>
                    <button id="hotkey-input" class="form-control hotkey-capture-btn">Click to set hotkey</button>
                    <div class="form-help">Click the button and press your desired key combination. Press <code>ESC</code> to clear.</div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-hotkey" class="btn btn-primary">Save</button>
                <button id="cancel-hotkey" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Camera Viewer Modal (created dynamically by openCamera) -->

    <!-- Alert Configuration Modal -->
    <div id="alert-config-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="alert-config-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="alert-config-title">Configure Alert</h2>
                <button id="close-alert-config" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Alert Type:</label>
                    <div class="alert-type-options">
                        <label class="radio-option">
                            <input type="radio" name="alert-type" value="state-change" checked>
                            <span class="radio-label">
                                <strong>State Change</strong>
                                <small>Notify when entity state changes</small>
                            </span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="alert-type" value="specific-state">
                            <span class="radio-label">
                                <strong>Specific State</strong>
                                <small>Notify when entity reaches a specific state</small>
                            </span>
                        </label>
                    </div>
                </div>
                <div class="form-group" id="specific-state-group" style="display: none;">
                    <label for="target-state-input">Target State:</label>
                    <input type="text" id="target-state-input" placeholder="e.g., on, off, open, closed" class="form-control">
                    <div class="form-help">Enter the state you want to be notified about</div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-alert" class="btn btn-primary">Save</button>
                <button id="cancel-alert" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Connecting to Home Assistant...</p>
    </div>

    <!-- Toast notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="renderer.js"></script>
</body>
</html>
