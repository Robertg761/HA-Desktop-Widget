<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Assistant Widget</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Minimal header with just drag area and essential controls -->
    <div class="widget-header">
        <div class="drag-area">
            <span class="widget-title">Home Assistant</span>
            <div class="connection-indicator" id="connection-status"></div>
        </div>
                <div class="header-controls">
                    <button id="settings-btn" class="control-btn" title="Settings">‚öôÔ∏è</button>
                    <button id="minimize-btn" class="control-btn" title="Minimize">‚ûñ</button>
                    <button id="close-btn" class="control-btn" title="Close">‚ùå</button>
                </div>
    </div>

    <!-- Main widget content - single view, no tabs -->
    <div class="widget-content">
        <!-- Quick Status Cards -->
        <div class="status-grid">
            <div class="status-card weather-card" id="weather-card" title="Long-press to configure weather">
                <div class="weather-icon" id="weather-icon">üå§Ô∏è</div>
                <div class="weather-content">
                    <div class="weather-main">
                        <div class="weather-temp" id="weather-temp">--¬∞</div>
                        <div class="weather-condition" id="weather-condition">--</div>
                    </div>
                    <div class="weather-details">
                        <div class="weather-detail">
                            <span class="detail-icon">üíß</span>
                            <span class="detail-value" id="weather-humidity">--%</span>
                        </div>
                        <div class="weather-detail">
                            <span class="detail-icon">üí®</span>
                            <span class="detail-value" id="weather-wind">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="status-card time-card" id="time-card">
                <div class="time-content">
                    <div class="time-main">
                        <div class="time-display" id="current-time">--:--</div>
                    </div>
                    <div class="date-display" id="current-date">--</div>
                </div>
            </div>
        </div>

        <!-- Quick Access -->
        <div class="controls-section">
                    <div class="section-header">
                        <span class="section-title">Quick Access</span>
                        <button id="manage-quick-controls-btn" class="section-btn" title="Manage Quick Access">‚ûï</button>
                    </div>
            <div id="quick-controls" class="controls-grid">
                <!-- Dynamic controls will be added here -->
            </div>
        </div>

        <!-- Entity Cards - Hidden by default, shown only when needed -->
        <div class="entities-section hidden">
            <div class="section-header">
                <span class="section-title">Entities</span>
                <div class="section-controls">
                    <button id="filter-btn" class="mini-btn" title="Filter">üîç</button>
                    <button id="layout-btn" class="mini-btn" title="Layout">üìê</button>
                </div>
            </div>
            <div id="entities-container" class="entities-grid">
                <!-- Dynamic entity cards will be added here -->
            </div>
        </div>

        <!-- Cameras (if any) -->
        <div class="cameras-section" id="cameras-section" style="display: none;">
            <div class="section-header">
                <span class="section-title">Cameras</span>
            </div>
            <div id="cameras-container" class="cameras-grid">
                <!-- Dynamic camera cards will be added here -->
            </div>
        </div>
    </div>

    <!-- Floating context menu (appears on right-click) -->
    <div id="context-menu" class="context-menu hidden">
        <div class="menu-item" data-action="refresh">üîÑ Refresh</div>
        <div class="menu-item" data-action="settings">‚öôÔ∏è Settings</div>
        <div class="menu-item" data-action="filter">üîç Filter</div>
        <div class="menu-item" data-action="layout">üìê Layout</div>
        <div class="menu-divider"></div>
        <div class="menu-item" data-action="minimize">‚ûñ Minimize</div>
        <div class="menu-item" data-action="close">‚ùå Close</div>
    </div>

    <!-- Settings Modal (same as before but cleaner) -->
    <div id="settings-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settings-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="settings-title">Settings</h2>
                <button id="close-settings" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Same settings content as before -->
                <div class="form-group">
                    <label for="ha-url">Home Assistant URL:</label>
                    <input type="text" id="ha-url" placeholder="http://homeassistant.local:8123">
                </div>
                <div class="form-group">
                    <label for="ha-token">Access Token:</label>
                    <input type="password" id="ha-token" placeholder="Your long-lived access token">
                </div>
                <div class="form-group">
                    <label for="update-interval">Update Interval (seconds):</label>
                    <input type="number" id="update-interval" min="1" max="60" value="5">
                </div>
                <div class="form-group">
                    <label for="opacity-slider">Window Opacity:</label>
                    <input type="range" id="opacity-slider" min="0.3" max="1" step="0.05" value="0.95">
                    <span id="opacity-value">95%</span>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="always-on-top">
                        Always on top
                    </label>
                </div>
                
                <!-- Update Section -->
                <div class="form-group update-section">
                    <label>Application Updates</label>
                    <div class="update-info">
                        <div class="version-info">
                            <span>Current Version: <strong id="current-version">Loading...</strong></span>
                        </div>
                        <div class="update-status" id="update-status">
                            <span id="update-status-text">Checking for updates...</span>
                        </div>
                        <div class="update-actions">
                            <button id="check-updates-btn" class="btn btn-secondary" disabled>
                                <span id="check-updates-text">Check for Updates</span>
                            </button>
                            <button id="install-update-btn" class="btn btn-primary hidden">
                                <span id="install-update-text">Install Update</span>
                            </button>
                        </div>
                        <div class="update-progress hidden" id="update-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                            <span class="progress-text" id="progress-text">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-settings" class="btn btn-primary">Save</button>
                <button id="cancel-settings" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Filter Modal (simplified) -->
    <div id="filter-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="filter-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="filter-title">Filter Entities</h2>
                <button id="close-filter" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Domains:</label>
                    <div id="filter-domains" class="checkbox-grid">
                        <!-- Dynamic checkboxes will be added here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="apply-filters" class="btn btn-primary">Apply</button>
                <button id="cancel-filters" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Entity Selector Modal -->
    <div id="entity-selector" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="entity-selector-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="entity-selector-title">Add Entities to Dashboard</h2>
                <button id="close-entity-selector" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" id="entity-search" placeholder="Search entities..." class="form-control">
                </div>
                <div class="form-group">
                    <label>Available Entities:</label>
                    <div id="available-entities-list" class="entity-selector-list">
                        <!-- Available entities will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Access Management Modal -->
    <div id="quick-controls-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="quick-controls-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="quick-controls-title">Manage Quick Access</h2>
                <button id="close-quick-controls" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" id="quick-controls-search" placeholder="Search entities..." class="form-control">
                </div>
                <div class="form-group">
                    <label>Available Entities for Quick Access:</label>
                    <div id="quick-controls-list" class="entity-selector-list">
                        <!-- Available entities will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Weather Configuration Modal -->
    <div id="weather-config-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="weather-config-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="weather-config-title">Configure Weather</h2>
                <button id="close-weather-config" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Select Weather Entity:</label>
                    <div id="weather-entities-list" class="entity-selector-list">
                        <!-- Available weather entities will be loaded here -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Current Weather Entity:</label>
                    <div id="current-weather-info" class="weather-info">
                        <span id="current-weather-name">None selected</span>
                        <button id="clear-weather" class="btn btn-secondary btn-sm">Clear</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Connecting to Home Assistant...</p>
    </div>

    <!-- Toast notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="renderer-final.js"></script>
</body>
</html>
